# Malware Software Security
---
## Malware
>System을 파괴하거나 Data, Application 등의 Confidentiality, Integrity, Availability를 침해하려는 의도로 만들어진 Software.  
- Malicious Software : Program exploiting system vulnerability, 특정 OS를 대상으로 공격이 진행된다.
  - Host program이 필요한 Software(e.g. Viruses, Logic bomb, Backdoor)
  - 독립적으로 자가 감염 및 복제가 가능한 프로그램(e.g. Worms, Bots)
  - 자가복제가 가능한 형태
- Malware은 Propagation의 기준에 따라 분류가 가능하고, Payloads(수행 동작)의 기준에 따라 분류가 가능하다.

### Malware Terminology
- Virus : 프로그램이 자기 자신을 정상적인 Software에 attach 시켜 기생한다.(Prepended, Postpended, Embeded)
- Worm : 자가 복제를 하며, 네트워크를 통해 다른 Host들로 자가 전파를 한다.(Self Replication)
- Logic bomb : 어떠한 조건을 만족하면, Payloads가 실행되는 Malware.
- Trojan horse : Masquerade, 정상적인 Software인 척 잠입하여 뒷 문을 열어주는 Malware.
- Backdoor : 허가되지 않은 권한을 우회하여 획득한 뒤 뒷 문을 열어주는 Malware.
- Mobile Code : 본디 Malware은 특정 OS에서만 작동을 하도록 설계되어, 다른 OS에서는 작동하지 않는다. 하지만 Mobile Code는 모든 OS에 작동하는 Malware이다.
- Auto-Rooterkit : Malicious Code를 자동으로 생성해주는 Kit.
- Spamming and Flooder : 불필요한 패킷들을 강제로 생산해내는 Malware.
- Keyloggers : Key가 눌린 기록들을 남기고 Capture 하는 Malware.(비밀번호 탈취 등에 사용 가능)
- Rootkit : Root 권한을 따내는 Kit
- Zombie(Bot) : 따로 PC에 피해를 입히지 않고, 오직 다른 PC들을 공격하기 위해 만들어진 감염체이다.
- Payloads : 악성코드가 수행해야할 동작
- Crimeware : Propagation과 Payload mechanism을 미리 작성해놓고 때에 맞춰 적용할 수 있도록 만들어진 Kit.(e.g. Zeus, Sakura, Pheonix)
- APT(Advanced Persistent Threat) : 섬세한 / 특정 타겟에게 / 오랫동안 지속되는 공격

### Viruses
>Program을 감염시키는 Program, Host Program에 기생해야만 작동이 가능하다.  
>특정 OS나 HW의 취약점을 공격하도록 설계되며, Prepended, Embeded, Postpended 방식으로 기생한다.  
- Viruses의 진행 과정
  - Dorment(Idle) : 잠복기, 동작이 되지 않으며 조건이 만족될 때 까지 동작하지 않는다.
  - Propagation : 전파기, 다른 프로그램들에 자신의 Copy를 전파시킨다.
  - Triggering : Virus에 저장되어있는 Payloads를 활성화시키는 단계.
  - Execution : Virus에 저장되어있는 Payloads를 직접 수행하는 단계.
- Virus Structure  

![VS](https://user-images.githubusercontent.com/71700079/113503341-3dc10a80-956c-11eb-945a-9cb2896d125a.PNG)  

- Compression Virus  

![CV](https://user-images.githubusercontent.com/71700079/113503365-58937f00-956c-11eb-8567-73a9466bd99a.PNG)  

- Virus Classification
  - Classify by Target
    - Boot Sector : 부팅 섹터에서 부터 이미 감염을 시켜 버리는 것.
    - File Infector : 중요한 OS 실행 파일을 대상으로 감염을 시키는 것.
    - Macro Virus : Application에 관련된 File들을 대상으로 감염을 시켜 오동작을 일으키는 것.
    - Multipartite : 위의 다양한 방법들을 모두 동원해 감염 시키는 것.
  - Classify by Concealment
    - Encrypted Virus : Virus 안에 Key가 저장되어 그 Key를 통해 암호화가 된 Virus.
    - Stealth Virus : 그 자체로 자신을 숨긴 바이러스(e.g. Compression Virus)
    - Polymorphic Virus : Virus는 보통 __Signature__ 을 달고있어 그것으로 구분이 가능한데, 그걸 계속 변경하며 숨기는 방식.
    - Metamorphic Virus : Virus의 Payloads 부분을 계속 바꾸면서 행위를 바꾸어 알아채지 못하도록 하는 방식.
    - Oligomorphism : 위에서 말한 Encrypted Virus가 자신의 Key를 계속 바꾸면서 행동을 하는 방식.
- Virus Countermeasure
  - Prevention : 가장 이상적인 방안, 감염되기 전에 예방을 하는 것!
  - Detection : 발생한 바이러스를 최대한 빠르게 탐지하는 것.
  - Identification : 정확하게 어떤 바이러스인지 구체적으로 알아내는 것.
  - Removal : 바이러스의 감염 경로 등 모든 흔적들을 싹 없애는 것.
  - Detected 되었지만, Identification이나 Removal이 제대로 진행이 되질 않는 경우, 프로그램을 아예 폐기를 해야 하는 경우도 발생한다.

#### Anti-Virus Evolution
>Virus가 침투 및 감염되는 방식들이 발전함에 따라 Anti-Virus Method들 또한 같이 발전해왔다.  
>그에 따라 Virus Code들이 매우 복잡해졌는데, 당연히 Countermeasure Codes 또한 같이 복잡해 질 수 밖에 없었다.  
- First Generation : Signature Scanner, 단순 비트 패턴의 탐지.
- Second Generation : Heuristics, 무결성 검사로 악성코드의 특징들을 가지고 있는지 검사하는 것.(e.g. SANDBOX(Behavior Blocking System))
- Third Generation : Identify Actions, 프로그램의 동작 수행 형태를 바탕으로 바이러스 탐지, Anomaly한 동작을 수행하는 Program이 존재하는가?
- Fourth Generation : 위의 모든 것을 다 합친 Countermeasure들에 대한 고찰 및 구현.
- Behavior Blocking Software(SANDBOX)  

![SNADMB](https://user-images.githubusercontent.com/71700079/113503606-ea4fbc00-956d-11eb-8409-6b1fc27b4417.PNG)  

>관리자 측에서 Policies를 설정 해놓으면, 그에 맞게 Firewall을 뚫고 들어온 프로그램의 행동이 과연 Policies에 부합한가?를 검사하여 SANDBOX에서 걸러내고 파일의 출입을 허가한다.

### Worms
>네트워크를 통해 전파되는 자가 복제 기능을 가진 형태의 Malware이다.  
- Phase
  - Dorment(idle) : Virus와 동일하게 조건이 만족되기 전 잠복하고 있는 기간.
  - Propagation : Virus와는 이 부분에서 차이가 있다. Virus는 Host가 존재하여 기생해서 자신의 Copy를 만드는 반면, Worm은 스스로 네트워크를 통해 자가복제한다.
  - Triggering : Virus와 동일하게 활성화 되는 단계.
  - Execution : 본격적으로 Payloads가 수행되는 단계.
- Worm의 특성 중 하나는, System Process 중 하나인 양 자신의 모습을 숨긴다는 것이다.  

- Worm Propagation Model
  - Simple Epidemic Model(SI Modeling)
    
    ![SImodel](https://user-images.githubusercontent.com/71700079/113166216-841d1d80-927d-11eb-8088-9f7f403541ab.PNG)  

    - Problems : Pairwise Infectious Rate값인 beta가 상수이며, Removal되는 경우를 생각하지 않는다.
  - General Epidemic Model(Kermack-McKendrick Model, SIR Modeling)  
  
    ![KM(SIR)](https://user-images.githubusercontent.com/71700079/113166238-8aab9500-927d-11eb-9926-d01c9bdf2cf0.PNG)  
  
    - Problems :  Pairwise Infectious Rate값인 beta가 상수이며, Removal되는 경우는 생각했지만, Sus -> Rem 인 경우를 생각하지 않는다.
  - Consider Human(extended from SIR Modeling)  
  
    ![extendedKM](https://user-images.githubusercontent.com/71700079/113166267-90a17600-927d-11eb-9391-6a2e94e2c27e.PNG)  
    
    - Consider Human Countermeasures : 컴퓨터 연결을 아예 종료하거나, 깨끗한 패치파일을 통해 업데이트를 하거나, 방화벽을 이용해 필터링을 한다.

  - Two-Factor Worm Modeling  
  
  ![twofactor](https://user-images.githubusercontent.com/71700079/113166294-98f9b100-927d-11eb-9473-3a14fa02fc00.PNG)  
  
### More Recent Worm Attacks
- Code Red : 웹서버를 대상으로 발생했던 DDoS(Distributed Denial Of Service)공격의 일환, 2001년.
- Code Red 2 : 이번에는 변형하여 해커가 직접 worm을 조종해서 Backdoor을 연 뒤 침투를 시켰다.
- SQL Slammer : Buffer-overflow Vulnerability를 Exploit하여 SQL 데이터베이스를 공격했던 사건, 매우 효과적이고 빠른 전파속도를 가졌다.
- Mydoom : Mass-E-mailing Worm, 2004.

### State of Worm Technology
- Multiplatform : 원래 Worm은 특정 OS를 대상으로 전파가 되는 Malware라서, 다른 OS에서는 사용이 불가능했었지만, 현재는 OS간의 이동 또한 가능해졌다. 
- Multi-exploit : 웹 서버, 이메일, 파일 공유 등 다양한 취약점에 대하여 공격이 가능해졌다.
- Ultrafast Propagation : Worm의 전파 속도가 비약적으로 증가했다.
- Polymorphic : Virus의 Polymorphic과 동일하게 각 전파되는 Copy마다 code의 형태가 변한다.
- Metamorphic : Virus의 Metamorphic과 동일하게 Worm의 Payloads 즉, Behavior이 Copy마다 변한다.
- Zero-day Exploitation : 취약점에 대한 패치가 아예 등장하지 않은 시점에서 시행되는 공격이다.

### Worm Countermeasures
- Anti-Virus Countermeasures와 겹치는 부분이 다수이다.
- Signature-Based worm scan filtering : Anti-Virus와 동일하게 Signature을 정의하여 Worm을 찾아내 필터링하는 것이다.
- Filter-Based worm Containment : 데이터의 내용물이 Worm으로 의심될 경우 필터링을 진행한다.
- Payload-Classification-Based Worm Containment : 네트워크 기반 전파이기 때문에 Packet을 조사하여 Anomaly한 행위가 포착되면 Contain 시키는 방식.
- Threshold random walk scan detection : 어떤 역치(Threshold)를 정해 놓고 그 역치를 벗어난 값이 발견되면 탐지하는 방식.
- Rate Limiting and Rate Halting : 역치를 만족을 했을 때, 데이터의 전송 트래픽에 제한을 두는 방식이다.

### Payload : Rootkits and Backdoor
- 허가 되지 않은 권한의 사용자가 Admin 권한에 접근을 하기위해 설치하는 Malware이다.
- Host의 OS에 Stealthy하게 침입하여 피해를 입힌다.
- 오랜 시간동안 공격이 지속되며, Memory-Based 공격으로 진행된다.
- 취약점을 Exploit하는 방식의 공격이 아니며, 해커가 직접 설치를 할 수도 있고 Trojan horse를 이용해 침입을 시킬 수도 있다.  

![rootkit](https://user-images.githubusercontent.com/71700079/113505242-7f57b280-9578-11eb-9220-503fc91f5fdb.PNG)  

#### Rootkit System Table Model : UNIX
![RK](https://user-images.githubusercontent.com/71700079/113505247-8da5ce80-9578-11eb-9b20-4742ca9e463c.PNG)
